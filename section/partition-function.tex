\section{Partition Function}

We wish to compute observables with the partition function
\begin{align}
	Z
	&=
	\tr{e^{-\beta(H-\mu N - \vec{h}\cdot\vec{S})}}
	&
	N &= \int d^2x\; \psi\adjoint(x)\psi(x)
	&
	\vec{S} = \half \int d^2x\; \psi\adjoint(x) ~ \vec{\sigma} ~ \psi(x)
\end{align}
where $N$ is the total number operator and $\vec{S}$ are spin operators which obey $[S^i, S^j] = i\epsilon^{ijk} S^k$.
In the latticized language 
\begin{align}
	N
	&\goesto
	\sum_x \Delta x^2 \psi\adjoint_x \psi_x
	=
	\sum_a \tilde{\psi}_a \tilde{\psi}_a
	=
	\sum_a \tilde{n}_a
	=
	\tilde{N}
	\\
	\vec{S}
	&\goesto
	\half \sum_x \Delta x^2 \psi\adjoint_x \vec{\sigma} \psi_x
	=
	\half \sum_a \tilde{\psi}\adjoint_a ~ \vec{\sigma} ~ \tilde{\psi}_a
	=
	\tilde{\vec{S}}
\end{align}
\emph{with no powers of $\Delta x$ required}.
Explicitly, the local spin operators are
\begin{align}
	\tilde{S}^1 &= \half \left(\tilde{\psi}\adjoint_\uparrow \tilde{\psi}_\downarrow + \tilde{\psi}\adjoint_\downarrow \tilde{\psi}_\uparrow\right)
	&
	\tilde{S}^2 &= \frac{i}{2} \left( \tilde{\psi}\adjoint_\downarrow \tilde{\psi}_\uparrow - \tilde{\psi}\adjoint_\uparrow \tilde{\psi}_\downarrow\right)
	&
	\tilde{S}^3 &= \half \left(\tilde{\psi}\adjoint_\uparrow \tilde{\psi}_\uparrow - \tilde{\psi}\adjoint_\downarrow \tilde{\psi}_\downarrow\right).
\end{align}
We can isolate the dimensionful quantities
\begin{align}
	Z
	&=
	\tr{e^{-\left(\frac{\beta}{M\Delta x^2}\right)(HM\Delta x^2 -M \Delta x^2 \mu N - M \Delta x^2 \vec{h} \cdot \vec{S})}}
\\
	&=
	\tr{e^{-\tilde{\beta}(\tilde{K}+\tilde{V}-\tilde{\mu} \tilde{N} - \tilde{\vec{h}}\cdot\tilde{\vec{S}})}}
	&
	\tilde{\beta} &= \frac{\beta}{M \Delta x^2}
	&
	\tilde{\mu}   &= M \Delta x^2 \mu
	&
	\tilde{\vec{h}} &= M \Delta x^2 \vec{h}
\end{align}
where $\tilde{\beta}$, $\tilde{\mu}$, and $\tilde{\vec{h}}$ are dimensionless, and $\tilde{K}$ and $\tilde{V}$ are the dimensionless kinetic and potential operators in the dimensionless Hamiltonian \eqref{dimensionless hamiltonian}.

\subsection{Dimensionless Path Integral}

In this subsection we derive a path integral expression for the spin-balanced partition function
\begin{align}
	Z
	&=
	\tr{e^{-\tilde{\beta}(\tilde{H}-\tilde{\mu}\tilde{N})}}~.
\end{align}
by Trotterizing  $\tilde{\beta}$ into $N_t$ time slices so that $\Delta \tilde{t} = \tilde{\beta}/N_t = \beta/M \Delta x^2 N_t$, which exactly matches $\hat{\gamma}$ in our prior work.
We begin with the identity
\begin{equation}
	e^{-\Delta \tilde{t}(\tilde{H} - \tilde{\mu}\tilde{N} - \tilde{\vec{h}}\cdot\tilde{\vec{S}})}
	=
	e^{-\Delta \tilde{t}\tilde{K} / 2}
	e^{-\Delta \tilde{t} (\tilde{V} - \tilde{\mu} \tilde{N})}
	e^{-\Delta \tilde{t}\tilde{K} / 2}
	+
	\mathcal{O}(\Delta \tilde{t}^3) 
\end{equation}
where $\tilde{H} = \tilde{K} + \tilde{V}$ has been decomposed into the kinetic energy $\tilde{K}$ and the interaction term $\tilde{V}$ as in \eqref{dimensionless hamiltonian}.
Therefore,
\begin{align}
	\tr{e^{-\tilde{\beta}(\tilde{H}-\tilde{\mu} \tilde{N})}}
	=
	\tr{
		\prod_{t=1}^{N_t}
		e^{-\Delta \tilde{t} (\tilde{H}-\tilde{\mu}\tilde{N})}
	}
	&=
	\tr{
		\prod_{t=1}^{N_t}
		e^{-\Delta \tilde{t}\tilde{K} / 2}
		e^{-\Delta \tilde{t} (\tilde{V} - \tilde{\mu} \tilde{N})}
		e^{-\Delta \tilde{t}\tilde{K} / 2}
	}
	+ \order{\Delta \tilde{t}^2}
	\nonumber\\
	&=
	\tr{
		\prod_{t=1}^{N_t}
		e^{-\Delta \tilde{t}\tilde{K}}
		e^{-\Delta \tilde{t} (\tilde{V} - \tilde{\mu} \tilde{N})}
	}
	+ \order{\Delta \tilde{t}^2}.
	\label{eq:trotterization}
\end{align}
which converges to the desired thermal trace as $\Delta \tilde{t} \goesto 0$.

We now begin a sequence of exact manipulations of the Trotterization \eqref{trotterization}.
Recall that the potential operator can be expressed as a sum of Lego spheres \eqref{dimensionless hamiltonian},
\begin{align}
	\tilde{V}
	&= \frac{1}{2} \sum_{ab} \tilde{n}_a \tilde{V}_{ab} \tilde{n}_b
	&
	\tilde{V}_{ab}
	&=
	\sum_{\vec{R}} \tilde{C}_{\vec{R}} \LegoSphere{\vec{R}}_{ab}
\end{align}
where $\tilde{V}_{ab}$ is a symmetric matrix and the radii $\vec{R}$ can be chosen however we like.
If $\tilde{V}$ has purely real negative eigenvalues (which imposes conditions on the bare coupling constants), then the following \emph{exact} Hubbard-Stratanovich transformation holds:
\begin{equation}
	\exp\left( \frac{1}{2} \sum_{ab}\tilde{n}_a \left(-\Delta\tilde{t} \tilde{V}\right)_{ab} \tilde{n}_b + \Delta \tilde{t} \tilde{\mu}\tilde{N}\right)
	=
	\frac{
		\int dA\; e^{-\frac{1}{2} A\transpose (-\Delta\tilde{t} \tilde{V})\inverse A + \tilde{n} \cdot (A + \Delta\tilde{t} \tilde{\mu} )}
	}{
		\int dA\; e^{-\frac{1}{2} A\transpose (-\Delta\tilde{t} \tilde{V})\inverse A}
	}
\end{equation}
where $A$ is a vector with $\Volume$ components but $\Delta\tilde{t}\tilde{\mu}$ is a spatial constant.
So, we have the \emph{exact} rewriting of the Trotterized partition function \eqref{trotterization}
\begin{equation}
	\tr{\prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{-\Delta \tilde{t}(\tilde{V} - \tilde{\mu}\tilde{N})} }
	= 
	\frac{  
		\int DA\; e^{-\frac{1}{2} \sum_t A\transpose_t (-\Delta\tilde{t} \tilde{V})\inverse A_t}
	~	\tr{\prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{ \tilde{n}\cdot (A_t + \Delta\tilde{t} \tilde{\mu})} } 
	}{ 
		\int DA\; e^{-\frac{1}{2} \sum_t A\transpose_t (-\Delta\tilde{t} \tilde{V})\inverse A_t}
	}
	\label{eq:trotterization bilinearized}
\end{equation}
where $DA = \prod_{t=1}^{N_t} d A_t $.\footnote{
	We choose to group the chemical potential term with $V$ rather than $K$.
	The main reason is that both $N$ and $V$ are formed from products of local densities which commute $[\tilde{n}_{\sigma}(x),\tilde{n}_{\sigma'}(x')] = 0$, and therefore functional derivatives are simple:
	\begin{align*}
		-\frac{1}{\Delta t} \frac{\partial}{\partial \mu_{\sigma 'a'}}\exp\left( V - \Delta t \sum_{\sigma a}\mu_{\sigma a} n_{\sigma a}\right) 
		&
		=  n_{\sigma' a'} \exp\left( V - \Delta t \sum_{\sigma a}\mu_{\sigma a} n_{\sigma a}\right)
		= \exp\left( V - \Delta t \sum_{\sigma a}\mu_{\sigma a} n_{\sigma a}\right) n_{\sigma' a'}~.
	\end{align*} 
	This property allows us to compute density correlation functions with ease.
	However, the simple ``pulling down" of operators by derivatives occurs \emph{only if the argument of the exponential and its derivative commute}~\cite{10.2307/4146900}.
	If we were to instead group the chemical potential terms with $K$, functional derivatives cease to be simple because $[K,n_{\sigma}(x)] \neq 0$.
}

Using fermion coherent states, we will now convert the trace over the Hilbert space into a determinant.
Using the conventions of Munster Ch. 4,
\begin{align}
	\tr{\prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{ \tilde{n}\cdot (A_t + \Delta\tilde{t} \tilde{\mu})} }
	=& \int \prod_{t=1}^{2N_t} d \eta^{\dagger}_t d\eta_t ~ e^{- \sum_{t}^{N_t}\sum_x \eta^{\dagger}_t(x) \eta_t(x)}~ \times
	\nonumber\\
	&
		\matrixElement{ -\eta_1 }{ e^{-\Delta \tilde{t}\tilde{K} }}{\eta_{2 N_t}}
		\matrixElement{ \eta_{2 N_t} }{ e^{ \tilde{n} \cdot (A_{N_t} + \Delta\tilde{t}\tilde{\mu}) } }{\eta_{2 N_t-1}} ~ \times
	\nonumber\\
	&
		\cdots
	\nonumber\\
	&
		\matrixElement{ \eta_5 }{ e^{-\Delta \tilde{t}\tilde{K} }}{\eta_{4}}
		\matrixElement{ \eta_4 }{ e^{ \tilde{n} \cdot (A_{2} + \Delta\tilde{t}\tilde{\mu})} }{\eta_3} ~ \times
	\nonumber\\
	&
		\matrixElement{ \eta_3 }{ e^{-\Delta \tilde{t}\tilde{K} }}{\eta_{2}}
		\matrixElement{ \eta_2 }{ e^{ \tilde{n} \cdot (A_{1} + \Delta\tilde{t}\tilde{\mu})} }{\eta_1}
\end{align}
where the coherent states
\begin{equation*}
	\ket{\eta_t} = \exp\left( \sum_{\sigma a} \tilde{\psi}^{\dagger}_{\sigma a} \eta_{\sigma a t} \right) \ket{0}
\end{equation*}
are spatial vectors and spin doublets on a single timeslice.
To proceed we leverage the exponential identity (4.33) of Munster,
\begin{equation}
	\matrixElement{ \eta }{ e^{\sum_{ij} \psi^{\dagger}_j A_{ji} \psi_i} }{ \eta' }
	=
	\exp\left[ \sum_{i j} \eta^{\dagger}_j (e^A)_{ji} \eta'_i \right]
\end{equation}
to carefully evaluate $\matrixElement{\eta}{ e^{-\Delta \tilde{t}\tilde{K}} }{\eta'}$ and $\matrixElement{\eta}{ e^{\tilde{n}\cdot(A_t + \Delta \tilde{t} \tilde{\mu})} }{\eta'}$, keeping careful track of the spin degree of freedom,
\begin{align}
		\matrixElement{\eta}{ e^{-\Delta \tilde{t} \tilde{K}} }{\eta'}
	&= 
		\matrixElement{\eta}{ \exp\left(-\Delta \tilde{t} \sum_{ab \sigma} \tilde{\psi}^{\dagger}_{\sigma a} \tilde{\kappa}_{ab} \tilde{\psi}_{\sigma b} \right)}{\eta'}
	\nonumber\\
	&=
		\matrixElement{\eta}{ \exp\left(
			\begin{bmatrix} \tilde{\psi}^{\dagger}_{1} &  \tilde{\psi}^{\dagger}_{2}  \end{bmatrix} 
			\begin{bmatrix}
				-\Delta \tilde{t} \tilde{\kappa}	& 0 \\
				0 									& -\Delta \tilde{t} \tilde{\kappa} 
			\end{bmatrix} 
			\begin{bmatrix} \tilde{\psi}_{1} \\  \tilde{\psi}_{2}  \end{bmatrix}
		\right) }{\eta'}
	\nonumber\\
	& = 
		\exp\left( 
			\begin{bmatrix} {\eta}^{\dagger}_{1} &  {\eta}^{\dagger}_{2}  \end{bmatrix} 
			\begin{bmatrix}
				-\Delta \tilde{t} \tilde{\kappa}	& 0 \\
				0 									& -\Delta \tilde{t} \tilde{\kappa} 
			\end{bmatrix} 
			\begin{bmatrix} {\eta}_{1}' \\  {\eta}_{2}'  \end{bmatrix}
		\right)
	\\
	& = 
		\exp\left( 
			\sum_{ab} \eta^{\dagger}_{1a} \left[e^{-\Delta \tilde{t} \tilde{\kappa}}\right]_{ab} \eta'_{1b}
		+	\sum_{ab} \eta^{\dagger}_{2a} \left[e^{-\Delta \tilde{t} \tilde{\kappa}}\right]_{ab} \eta'_{2b}
		\right)
\end{align}
where $\tilde{\kappa}$ is given in the dimensionless Hamiltonian \eqref{dimensionless hamiltonian} \todo{and includes the C0 shift!}.
By an analogous sequence of manipulations, one also finds
\begin{align}
	\matrixElement{\eta}{ e^{\tilde{n} \cdot (A_t + \Delta\tilde{t} \tilde{\mu})} }{\eta'}
	&=
		\matrixElement{\eta}{ \exp\left(
			\begin{bmatrix} \tilde{\psi}^{\dagger}_{1} &  \tilde{\psi}^{\dagger}_{2}  \end{bmatrix} 
			\begin{bmatrix}
				A + \Delta \tilde{t} \tilde{\mu}	& 0 \\
				0 									& A +\Delta \tilde{t} \tilde{\mu} 
			\end{bmatrix} 
			\begin{bmatrix} \tilde{\psi}_{1} \\  \tilde{\psi}_{2}  \end{bmatrix}
		\right) }{\eta'}
	\label{eq:gaussian spinors}\\
	& = 
		\exp\left( 
			\sum_{ab}\eta^{\dagger}_{1a} \left[e^{A_t + \Delta t \mu}\right]_{ab} \eta'_{1b}
		+	\sum_{ab}\eta^{\dagger}_{2b} \left[e^{A_t + \Delta t \mu}\right]_{ab} \eta'_{2b}
		\right)
\end{align}
where
\begin{align}
	\left[e^{A_t+ \Delta \tilde{t} \tilde{\mu}}\right]_{ab} &= \delta_{ab} e^{A_{xt} + \Delta \tilde{t} \tilde{\mu}}~.
\end{align}
So, we can rewrite the Hilbert space trace in the bilinearized Trotterization \eqref{trotterization bilinearized}
\begin{align}
	\tr{\prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{ \tilde{n}\cdot (A_t + \Delta\tilde{t} \tilde{\mu})} }
	=& \int D\eta\adjoint D\eta \exp\left( - \sum_{t=1}^{2N_t}\sum_{a\sigma} \eta\adjoint_{\sigma a t} \eta_{\sigma a t}\right)~ \times
	\nonumber\\
	&
		\exp\left[ \sum_{ab\sigma} (-\eta_{\sigma a\;1})\adjoint \left(e^{-\Delta \tilde{t} \tilde{\kappa}}\right)_{ab} \eta_{\sigma b\;2N_t} \right]
		\exp\left[ \sum_{ab\sigma} \eta\adjoint_{\sigma a\;2N_t} \left(e^{A_{N_t}+\Delta\tilde{t}\tilde{\mu}}\right)_{ab} \eta_{\sigma b\;2N_t-1}\right] ~ \times
	\nonumber\\
	&
		\cdots
	\nonumber\\
	&
		\exp\left[ \sum_{ab\sigma} \eta\adjoint_{\sigma a\;5} \left(e^{-\Delta \tilde{t} \tilde{\kappa}}\right)_{ab} \eta_{\sigma b\;4} \right]
		\exp\left[ \sum_{ab\sigma} \eta\adjoint_{\sigma a\;4} \left(e^{A_{2}+\Delta\tilde{t}\tilde{\mu}}\right)_{ab} \eta_{\sigma b\;3}\right] ~ \times
	\nonumber\\
	&
		\exp\left[ \sum_{ab\sigma} \eta\adjoint_{\sigma a\;3} \left(e^{-\Delta \tilde{t} \tilde{\kappa}}\right)_{ab} \eta_{\sigma b\;2} \right]
		\exp\left[ \sum_{ab\sigma} \eta\adjoint_{\sigma a\;2} \left(e^{A_{1}+\Delta\tilde{t}\tilde{\mu}}\right)_{ab} \eta_{\sigma b\;1}\right]
\end{align}
where the measure is given by
\begin{equation}
	D\eta\adjoint D\eta \equiv \prod_{t=1}^{2N_t} \left\{ \prod_{a, \sigma} d \eta^{\dagger}_{\sigma a\; t} d\eta_{\sigma a\; t} \right\}.
\end{equation}

Performing the Grassmannian integration yields a fermion determinant,
\begin{align}
	\tr{\prod_{t=1}^{N_t} e^{-\Delta \tilde{t}(\tilde{K} - \tilde{\mu} \tilde{N})} e^{ \tilde{n}\cdot A_t} }
	=
	\int D\eta\adjoint D\eta ~ e^{- \eta^{\dagger} ~ \DD ~ \eta} = \det \DD
\end{align}
where $\DD$ is $(2\text{ spins})\times(2N_t)\times(\Volume)$ on a side.
Separating out the spin dimension,
\begin{align}
	\DD
	&=
	\begin{bmatrix} D' & 0 \\ 0 & D' \end{bmatrix}
	&
	D'
	&=
	\begin{bmatrix} 
		\one                                & 0         & 0                                     & 0         & 0      & \cdots & 0       & 0                                         & +B^{-1}
	\\	-e^{A_1+\Delta\tilde{t}\tilde{\mu}} & \one      & 0                                     & 0         & 0      & \cdots & 0       & 0                                         & 0
	\\	0                                   & -B^{-1}   & \one                                  & 0         & 0      & \cdots & 0       & 0                                         & 0
	\\	0                                   & 0         & -e^{A_2+\Delta\tilde{t}\tilde{\mu}}   & \one      & 0      & \cdots & 0       & 0                                         & 0
	\\	0                                   & 0         & 0                                     & -B^{-1}   & \one   & \cdots & 0       & 0                                         & 0
	\\	\vdots                              & \vdots    & \vdots                                & \vdots    & \vdots & \ddots & \vdots  & \vdots                                    & \vdots
	\\	0                                   & 0         & 0                                     & 0         & 0      & \cdots & -B^{-1} & \one                                      & 0
	\\	0                                   & 0         & 0                                     & 0         & 0      & \cdots & 0       & -e^{A_{N_t}+\Delta\tilde{t}\tilde{\mu}}   & \one
	\end{bmatrix}
	&
	\det\DD = \left(\det D'\right)^2
\end{align}
where $D'$ is a block matrix with $2N_t$ blocks of side length $\Volume$ per side.
The block matrix
\begin{equation}
	D
	=
	\begin{bmatrix}
		B                                      & 0                                      & 0                                      & 0      & \cdots & 0                                            & e^{A_{N_t}+ \Delta \tilde{t} \tilde{\mu}}
	\\	-e^{A_1+ \Delta \tilde{t} \tilde{\mu}} & B                                      & 0                                      & 0      & \cdots & 0                                            & 0
	\\	0                                      & -e^{A_2+ \Delta \tilde{t} \tilde{\mu}} & B                                      & 0      & \cdots & 0                                            & 0
	\\	0                                      & 0                                      & -e^{A_3+ \Delta \tilde{t} \tilde{\mu}} & B      & \cdots & 0                                            & 0
	\\	\vdots                                 & \vdots                                 & \vdots                                 & \vdots & \ddots & \vdots                                       & \vdots
	\\	0                                      & 0                                      & 0                                      & 0      & \cdots & B                                            & 0
	\\	0                                      & 0                                      & 0                                      & 0      & \cdots & -e^{A_{N_t-1}+ \Delta \tilde{t} \tilde{\mu}} & B
	\end{bmatrix}
	\label{eq:fermion matrix}
\end{equation} 
has only $N_t$ blocks per side and its determinant is equal up to a constant factor
\begin{align}
	\det D' &= \frac{ \det D }{ \det B^{N_t} } = \frac{ \det D }{ \det \exp \tilde{\beta} \tilde{\kappa} },
	&
	B &= \exp \Delta\tilde{t} \tilde{\kappa}
\end{align}
Either may be used in simulations; we use the latter.
Therefore, one finally has a numerical prescription for the Trotterized trace \eqref{trotterization}
\begin{align}
	\tr{ \prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{-\Delta \tilde{t} (\tilde{V} - \tilde{\mu}\tilde{N})}  }
	=&
	\frac{\det \exp\left( -2 \tilde{\beta}\tilde{\kappa}\right)}{ \int DA ~ e^{-\half \sum_t A_t (-\Delta\tilde{t}\tilde{V})\inverse A_t } } ~ \times
	\int DA ~ e^{-\half \sum_t A_t (-\Delta\tilde{t}\tilde{V})\inverse A_t } \det D^2
\end{align}
which is manifestly positive-definite since all the entries of $D$ are real.
We can cast the determinant up into the action,
\begin{align}
	\tr{ \prod_{t=1}^{N_t} e^{-\Delta \tilde{t}\tilde{K}}  e^{-\Delta \tilde{t} (-\tilde{V} - \tilde{\mu}\tilde{N})}  }
	=&
	~\mathcal{N}
	\int DA ~ \exp -\left(S = \half \sum_t A_t (\Delta\tilde{t}\tilde{V})\inverse A_t - \log \det D^2 \right)
\end{align}
where $\mathcal{N}$ is a constant that will cancel from many derivatives of the free energy.
If we keep the Grassman variables, we can instead write the action $S$ as
\begin{align}
	S = 
	\frac{1}{2} \sum_{ab t} A_{at} \left[(-\Delta\tilde{t} \tilde{V})\inverse\right]_{ab} A_{bt}
+	\sum_{ab t \sigma} \eta\adjoint_{\sigma a t} \left[ e^{\Delta\tilde{t}\tilde{\kappa}}\right]_{ab} \eta_{\sigma b t}
-	\sum_{a t \sigma}\eta\adjoint_{\sigma a\; t+1} e^{A_{at} + \Delta \tilde{t} \tilde{\mu}} \eta_{\sigma a t}
\end{align}

\subsubsection{Incorporating Spin Chemical Potential}

We may wish to create spin imbalance by including a spin chemical potential $\vec{h}$ so that the partition function is
\begin{align}
	Z &= \tr{e^{-\tilde{\beta}\left(\tilde{H} - \tilde{\mu}\tilde{N} - \tilde{h}\cdot\tilde{S}\right)} }
	&
	S &= \int d^2x~ S(x) \goesto \sum_a \Delta x^2 S_a = \sum_a \tilde{S}_a = \tilde{S}
	&
	\tilde{S}_a &= \half \sum_{\alpha \alpha'} \tilde{\psi}\adjoint_{\alpha a} \sigma_{\alpha \alpha'} \tilde{\psi}_{\alpha' a}
\end{align}
where $\alpha$ runs over the two spins and we leave off the spatial index for the spatially summed operator.
These spin operators are 3-vectors (from the vector of Pauli $\sigma$s) and obey the expected algebra
\begin{align}
	[\tilde{S}_a^i, \tilde{S}_b^j] &= i \epsilon^{ijk} \tilde{S}^k_a \delta_{ab} \qquad\text{(no sum)}
\end{align}
It is possible to show that $[\tilde{S}, \tilde{H}] = 0$ and $[\tilde{S}_a, \tilde{n}_b] = 0$ so that $[\tilde{S}, \tilde{H} - \tilde{\mu}\tilde{N}] = 0$.

Because the spin and number operators commute, the spin operators go along for the ride on the Hubbard-Stratanovich transformation without issue.
The difference begins with the matrix representation in the Grassman space \eqref{gaussian spinors}, which becomes
\begin{align}
	\matrixElement{\eta}{ e^{\tilde{n} \cdot (A_t + \Delta\tilde{t} \tilde{\mu}) + \tilde{h} \cdot \tilde{S}} }{\eta'}
	&=
		\matrixElement{\eta}{ \exp\left(
			\begin{bmatrix} \tilde{\psi}^{\dagger}_{1} &  \tilde{\psi}^{\dagger}_{2}  \end{bmatrix} 
			\begin{bmatrix}
				A + \Delta \tilde{t} (\tilde{\mu} + \half h_3)	& \half \Delta\tilde{t}(h_1 - i h_2) \\
				\half \Delta\tilde{t}(h_1 + i h_2) 				& A +\Delta \tilde{t} (\tilde{\mu} - \half h_3)
			\end{bmatrix} 
			\begin{bmatrix} \tilde{\psi}_{1} \\  \tilde{\psi}_{2}  \end{bmatrix}
		\right) }{\eta'}
	\nonumber\\
	&=
		\matrixElement{\eta}{ \exp\left(
			\begin{bmatrix} \tilde{\psi}^{\dagger}_{1} &  \tilde{\psi}^{\dagger}_{2}  \end{bmatrix} 
			\left( (A+\Delta\tilde{t}\tilde{\mu}) \sigma^0 + \half \Delta\tilde{t}\tilde{h}\cdot\sigma\right)
			\begin{bmatrix} \tilde{\psi}_{1} \\  \tilde{\psi}_{2}  \end{bmatrix}
		\right) }{\eta'}
	\nonumber\\
	&=
		\exp\left(
			\begin{bmatrix} \eta^{\dagger}_{1} &  \eta^{\dagger}_{2}  \end{bmatrix} 
			\exp\left( (A+\Delta\tilde{t}\tilde{\mu}) \sigma^0 + \half \Delta\tilde{t}\tilde{h}\cdot\sigma\right)
			\begin{bmatrix} \eta'_{1} \\  \eta'_{2}  \end{bmatrix}
		\right)
	\nonumber\\
	&=
		\exp\left(
			\begin{bmatrix} \eta^{\dagger}_{1} &  \eta^{\dagger}_{2}  \end{bmatrix} 
			\exp\left( (A+\Delta\tilde{t}\tilde{\mu}) \sigma^0 \right) 
			\left[\sigma^0 \cosh \sqrt{\oneover{4}\Delta \tilde{t}^2 \tilde{h}^2} + \frac{\tilde{h} \cdot \sigma}{\sqrt{h^2}} \sinh \sqrt{\oneover{4}\Delta\tilde{t}^2 \tilde{h}^2}  \right]
			\begin{bmatrix} \eta'_{1} \\  \eta'_{2}  \end{bmatrix}
		\right).
\end{align}
This propagates straightforwardly to the fermion matrix $\DD$,
\begin{align}
    \DD &= \begin{bmatrix} D'(+h) & O(h) \\ O(h)\conjugate & D'(-h) \end{bmatrix}
    \\
    D'(\tilde{h}) &=
	\begin{bmatrix} 
	\one            & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                     & +B^{-1}
\\	-F_1(\tilde{h}) & \one      & 0                 & 0         & 0      & \cdots & 0       & 0                     & 0
\\	0               & -B^{-1}   & \one              & 0         & 0      & \cdots & 0       & 0                     & 0
\\	0               & 0         & -F_2(\tilde{h})   & \one      & 0      & \cdots & 0       & 0                     & 0
\\	0               & 0         & 0                 & -B^{-1}   & \one   & \cdots & 0       & 0                     & 0
\\	\vdots          & \vdots    & \vdots            & \vdots    & \vdots & \ddots & \vdots  & \vdots                & \vdots
\\	0               & 0         & 0                 & 0         & 0      & \cdots & -B^{-1} & \one                  & 0
\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & -F_{N_t}(\tilde{h})   & \one
	\end{bmatrix}
	\label{eq:D prime with h}
	\\
	F_t(\tilde{h}) &= e^{A_t + \Delta\tilde{t}\tilde{\mu}} \left(\cosh \sqrt{\oneover{4}\Delta\tilde{t}^2 \tilde{h}^2} + \frac{\tilde{h}_3}{\sqrt{\tilde{h}^2}} \sinh\sqrt{\oneover{4}\Delta\tilde{t}^2 \tilde{h}^2}\right)
    \\
    O(\tilde{h}) &=
	\begin{bmatrix} 
	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                    & 0
\\	-G_1(\tilde{h}) & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                    & 0
\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                    & 0
\\	0               & 0         & -G_2(\tilde{h})   & 0         & 0      & \cdots & 0       & 0                    & 0
\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                    & 0
\\	\vdots          & \vdots    & \vdots            & \vdots    & \vdots & \ddots & \vdots  & \vdots               & \vdots
\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                    & 0
\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & -G_{N_t}(\tilde{h})  & 0
	\end{bmatrix}
    \\
	G_t(\tilde{h}) &= e^{A_t + \Delta\tilde{t}\tilde{\mu}} \frac{\tilde{h}_1 - i\tilde{h}_2}{\sqrt{\tilde{h}^2}} \sinh\sqrt{\oneover{4}\Delta\tilde{t}^2 \tilde{h}^2}
\end{align}
When the spin chemical potential points purely in the $z$ direction the spin-off-diagonal block matrices $G$ all vanish and we get the simplifications
\begin{align}
	F_t(\tilde{h}) &= e^{A_t + \Delta\tilde{t}\tilde{\mu}} e^{\half \Delta\tilde{t} \tilde{h}_3} = e^{A_t + \Delta\tilde{t}\tilde{\mu} + \half \Delta\tilde{t} \tilde{h}_3}
	&
	\det \DD &= \det D'(+\tilde{h}_3) D'(-\tilde{h}_3)
	&
	(\text{only when }\tilde{h}_1=\tilde{h}_2=0)
	\label{eq:fermion determinant with h3}
\end{align}
and we can reduce the $2N_t$ timeslices of $D'(\pm\tilde{h}_3)$ to the $N_t$ timeslices of $D(\pm\tilde{h}_3)$ as before \eqref{fermion matrix}.

When the spin chemical potential points purely in the $x$ direction one may leverage the formula
\begin{align}
	\det \begin{bmatrix} A & B \\ B & A \end{bmatrix} &= \det(A-B) \det(A+B)
	&\goesto
	&&
	\det \DD &= \det(D'-O) \det(D'+O)
	&
	(\text{only when }\tilde{h}_2=\tilde{h}_3=0)
\end{align}
\todo{Is a similar reduction, or a nice determinant formula, possible in general?}

Perhaps a more amenable way to formulate the needed fermion determinant is to make spin fastest.
Then, if
\begin{align}
	\FF &= \exp\left( (A+\Delta\tilde{t}\tilde{\mu})\sigma^0 + \half \Delta\tilde{t}\tilde{h}\cdot \sigma\right)
	&
	\BB\inverse &= B\inverse \sigma^0
\end{align}
we can write
\begin{align}
	\DD = \begin{bmatrix} 
			\one            & 0         & 0                 & 0         & 0      & \cdots & 0       & 0                     & +\BB^{-1}
		\\	-\FF_1(\tilde{h}) & \one      & 0                 & 0         & 0      & \cdots & 0       & 0                     & 0
		\\	0               & -\BB^{-1}   & \one              & 0         & 0      & \cdots & 0       & 0                     & 0
		\\	0               & 0         & -\FF_2(\tilde{h})   & \one      & 0      & \cdots & 0       & 0                     & 0
		\\	0               & 0         & 0                 & -\BB^{-1}   & \one   & \cdots & 0       & 0                     & 0
		\\	\vdots          & \vdots    & \vdots            & \vdots    & \vdots & \ddots & \vdots  & \vdots                & \vdots
		\\	0               & 0         & 0                 & 0         & 0      & \cdots & -\BB^{-1} & \one                  & 0
		\\	0               & 0         & 0                 & 0         & 0      & \cdots & 0       & -\FF_{N_t}(\tilde{h})   & \one
	\end{bmatrix}
\end{align}
which is essentially just $D'(h)$ \eqref{D prime with h} but with the blocks promoted to bigger blocks.
The determinant of $\DD$ is equal to the determinant of
\begin{align}
    \dd
	=
	\begin{bmatrix}
			\BB                  & 0                             & 0                             & 0             & \cdots & 0                                & +\FF_{N_t}(\tilde{h})
		\\	-\FF_{1}(\tilde{h})  & \BB                    & 0                             & 0             & \cdots & 0                                & 0
		\\	0                           & -\FF_{2}(\tilde{h})    & \BB                    & 0             & \cdots & 0                                & 0
		\\	0                           & 0                             & -\FF_{3}(\tilde{h})    & \BB    & \cdots & 0                                & 0
		\\	\vdots                      & \vdots                        & \vdots                        & \vdots        & \ddots & \vdots                           & \vdots
		\\	0                           & 0                             & 0                             & 0             & \cdots & \BB                       & 0
		\\	0                           & 0                             & 0                             & 0             & \cdots & -\FF_{N_t-1}(\tilde{h})   & \BB
	\end{bmatrix}
\end{align}
up to a constant
\begin{align}
    \det \DD = \frac{ \det \dd }{ \det \BB^{N_t} } = \frac{ \det \dd }{ \det \exp 2 \tilde{\beta}\tilde{\kappa} }
\end{align}
and we can write the $\det \dd$ in terms of a `block sausage'.
Just like $\FF$, the block sausage is block-diagonal in the case when $\tilde{h}=\tilde{h}_3$ and $\tilde{h}_1=\tilde{h}_2=0$ so that $\det \dd = \det( D(+\tilde{h}_3) D(-\tilde{h}_3)$ factorizes as before \eqref{fermion determinant with h3}; when $\tilde{h}=0$ the two blocks are equal and $\det\dd = \det D^2$, since $\FF(0)\propto\sigma^0$.

\subsection{Deriving Path Integral}
In this subsection we derive a path integral expression for the partition function
\begin{align}
	Z
	&=
	\tr{e^{-\beta(H-\mu N)}}~.
\end{align}
We begin with the identity
\begin{equation}
e^{-\Delta t(H - \mu N)} = e^{-\Delta t/2(V - \mu N)}  e^{-\Delta t K}  e^{-\Delta t/2(V - \mu N)} + \mathcal{O}(\Delta t^3) 
\end{equation}
where $H = K + V$ has been decomposed into the kinetic energy $K$ and the interaction term $V$. Therefore,
\begin{align}
\tr{\prod_{t=1}^{N_t} e^{-\Delta t/2(V - \mu N)}  e^{-\Delta t K}  e^{-\Delta t/2(V - \mu N)}} & =
\tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  } \\
& =  \tr{e^{-\beta(H-\mu N)}} + \mathcal{O}(\Delta t^2)
\end{align}
We now begin a sequence of exact manipulations of the object 
\begin{equation}
\tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  }~,
\end{equation}
which converges to the desired partition function as $\Delta t \rightarrow 0$ . First note that
\begin{equation}
V =  \frac{1}{2} \sum_{xy} \Delta x^4 n_x V_{xy} n_y = \frac{1}{2} \sum_{xy} \tilde{n}_x V_{xy} \tilde{n}_y 
\end{equation}
where 
\begin{equation}
V_{xy} = \frac{g}{\Delta x^2} \mathcal{S}^0_{x y} + \frac{C_{ \vec{R} }}{\Delta x^2} \mathcal{S}^{ \vec{R} }_{xy}
\end{equation}
is a symmetric matrix. If V has purely real $\&$ positive eigenvalues (which imposes conditions on the bare coupling constants), then the following Hubbard-Stratanovich transformation holds:
\begin{equation}
\frac{\int d {A} e^{-\frac{1}{2} {A}^T M A + \tilde{n} \cdot (A+\Delta t \mu) } }{ \int d {A} e^{-\frac{1}{2} {A}^T M A  } }
=
\text{exp}\Bigg( \frac{1}{2} \sum_{x y}\tilde{n}(x) (M^{-1})_{xy} \tilde{n}(y) + \Delta t \mu \sum_x \tilde{n}(x) \Bigg) 
\end{equation}
where $A$ is a vector with $N_x^2$ number of components and where
\begin{equation}
\tilde{n}\cdot (A + \Delta t \mu) \equiv \sum_x \tilde{n}(x) ( A(x) +\Delta t \mu)~.
\end{equation}
Choosing $(M^{-1})_{xy} = (-\Delta t V)_{xy}$, one then has the following
\begin{equation}
\tr{\prod_{t=1}^{N_t} e^{-\Delta t K}  e^{-\Delta t (V - \mu N)}  } = 
\frac{  
\int DA ~ e^{-\frac{1}{2} \sum_t {A}_t M {A}_t M A_t} ~ \tr{\prod_{t=1}^{N_t} e^{-\Delta t K}  e^{ \tilde{n}\cdot (A_t + \Delta t \mu )} } 
}{ 
\int DA ~ e^{-\frac{1}{2} \sum_t {A}_t M {A}_t M A_t}  
}
\end{equation}
where $DA = \prod_{t=1}^{N_t} d A_t $ . Notice that this is an \emph{exact} rewriting of the trotterized partition function. \\

\begin{center} 
\textcolor{red}{Begin aside...} \\
\end{center}
Before moving on, let us discuss why we choose to group the chemical potential term with $V$ rather than $K$. The main reason is that both $N$ and $V$ are formed from products of local densities which satisfy
\begin{equation*}
[\tilde{n}_{\sigma}(x),\tilde{n}_{\sigma'}(x')] = 0~,
\end{equation*}
and therefore functional derivatives are simple:
\begin{align*}
-\frac{1}{\Delta t} \frac{\partial}{\partial \mu_{\sigma '}(x')}\text{exp}\Big( V - \Delta t \sum_{\sigma x}\mu_{\sigma}(x) n_{\sigma}(x)\Big) & =  n_{\sigma ' }(x') \text{exp}\Big( V - \Delta t \sum_{\sigma x}\mu_{\sigma}(x) n_{\sigma}(x)\Big) \\
& =  \text{exp}\Big( V - \Delta t \sum_{\sigma x}\mu_{\sigma}(x) n_{\sigma}(x)\Big) n_{\sigma ' }(x')~.
\end{align*} 
This property allows us to compute density correlation functions with ease. However, the simple ``pulling down" of operators by derivatives occurs \textbf{only if the argument of the exponential and its derivative commute} \cite{10.2307/4146900}. If we were to instead group the chemical potential terms with $K$, functional derivatives cease to be simple because $[K,n_{\sigma}(x)] \neq 0$: 
\begin{align*}
-\frac{1}{\Delta t} \frac{\partial}{\partial \mu_{\sigma '}(x')}\text{exp}\Big( K - \Delta t \sum_{\sigma x}\mu_{\sigma}(x) n_{\sigma}(x)\Big) & \neq n_{\sigma'}(x') \text{exp}\Big( K - \Delta t \sum_{\sigma x}\mu_{\sigma}(x) n_{\sigma}(x)\Big)~.
\end{align*}
\begin{center}
\textcolor{red}{...end aside.} \\
\end{center} 

Let us continue our quest. Using fermion coherent states, we will now convert the Hilbert space trace into a determinant . One has (using the conventions of Munster Ch. 4)
\begin{align*}
& \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{ \tilde{n}\cdot (A_t + \Delta t \mu) } }  
= 
\int{} \prod_{t=1}^{2N_t} \Bigg\{ \prod_{x, \sigma} d \eta^{\dagger}_{\sigma}(x,t) d\eta_{\sigma}(x,t) \Bigg\} ~ \text{exp}\Big(- \sum_{t=1}^{2N_t}\sum_{x \sigma} \eta^{\dagger}_{\sigma}(x,t) \eta_{\sigma}(x,t)\Big)~ \times \\
& \langle -\eta_1 | e^{-\Delta t K} | \eta_{2 N_t} \rangle \, \langle \eta_{2 N_t} | e^{ \tilde{n} \cdot (A_{N_t} + \Delta t \mu)} | \eta_{2 N_t -1} \rangle ....
\langle \eta_5 | e^{-\Delta t K} | \eta_4 \rangle \, \langle \eta_4 | e^{ \tilde{n} \cdot (A_2 +\Delta t \mu)} | \eta_3 \rangle
\langle \eta_3 | e^{-\Delta t K } | \eta_2 \rangle \, \langle \eta_2 | e^{ \tilde{n} \cdot (A_1 + \Delta t \mu)} | \eta_1 \rangle~,
\end{align*}
where 
\begin{equation*}
| \eta_t \rangle = \text{exp}\Big( \sum_{x \sigma} \tilde{\psi}^{\dagger}_{\sigma}(x) \eta_{\sigma}(x,t) \Big) | 0 \rangle
\end{equation*}
is a coherent state on a single timeslice. This expression above is admittedly horrific; to proceed we use Eq. 4.33 of Munster, which states
\begin{equation}
\langle \eta | e^{\sum_{ij} a^{\dagger}_j A_{ji} a_i} | \eta' \rangle = \text{exp}\Bigg[ \sum_{i j} \eta^{\dagger}_j (e^A)_{ji} \eta'_i \Bigg]~.
\end{equation}
Let us very carefully evaluate $\langle \eta | e^{-\Delta t K} | \eta' \rangle$ and $\langle \eta | e^{\tilde{n} \cdot(A_t + \Delta t \mu)} | \eta' \rangle$, keeping careful track of the spin degree of freedom. 
\begin{align*}
\langle \eta | e^{-\Delta t K} | \eta' \rangle 
= 
\langle \eta | \text{exp}\Bigg(-\Delta t \sum_{x y \sigma} \tilde{\psi}^{\dagger}_{\sigma}(x) k_{x y} \tilde{\psi}_{\sigma}(y) \Bigg) | \eta' \rangle
& =
\langle \eta | \text{exp}\Bigg( 
\begin{bmatrix} \tilde{\Psi}^{\dagger}_{1} &  \tilde{\Psi}^{\dagger}_{2}  \end{bmatrix} 
\begin{bmatrix}
-\Delta t k & 0 \\
0 & -\Delta t k 
\end{bmatrix} 
\begin{bmatrix} \tilde{\Psi}_{1} \\  \tilde{\Psi}_{2}  \end{bmatrix} \Bigg)
| \eta' \rangle \\
& = 
\text{exp}\Bigg( 
\begin{bmatrix} {\eta}^{\dagger}_{1} &  {\eta}^{\dagger}_{2}  \end{bmatrix} 
\begin{bmatrix}
e^{-\Delta t k} & 0 \\
0 & e^{-\Delta t k}
\end{bmatrix} 
\begin{bmatrix} {\eta}_{1}' \\  {\eta}_{2}'  \end{bmatrix}  \Bigg) \\
& = 
\text{exp}\Bigg( 
\sum_{xy}\eta^{\dagger}_1(x) e^{-\Delta t k}_{xy} \eta_1'(y) + \sum_{xy}\eta^{\dagger}_2(x) e^{-\Delta t k}_{xy} \eta_2'(y) \Bigg)
\end{align*}
where we defined $\tilde{\Psi}_{\sigma}$, which is a vector with $N_x^2$ components containing all fermion fields of spin $\sigma$ on a single timeslice and where
\begin{equation}
\big(k\big)_{xy} = \frac{1}{N_x^2} \sum_{\tilde{p}} \frac{\tilde{p}^2}{2 M \Delta x^2} e^{-i \tilde{p} (\tilde{x}-\tilde{y})}
\end{equation}
is the matrix exponentiated in $e^{-\Delta t k}$. By an analogous sequence of manipulations, one also finds
\begin{align*}
\langle \eta | e^{ \tilde{n} \cdot (A_t + \Delta t \mu)} | \eta' \rangle 
& = 
\text{exp}\Bigg( 
\sum_{xy}\eta^{\dagger}_1(x) e^{A_t + \Delta t \mu}_{xy} \eta_1'(y) + \sum_{xy}\eta^{\dagger}_2(x) e^{A_t + \Delta t \mu}_{xy} \eta_2'(y) \Bigg)
\end{align*}
where
\begin{equation}
e^{A_t+ \Delta t \mu}_{xy} = \delta_{xy} e^{A(x,t) + \Delta t \mu}~.
\end{equation}


One therefore has
\begin{align*}
& \tr{\prod_{t=1}^{N_t} e^{-\Delta t K}  e^{ \tilde{n}\cdot (A_t + \Delta t \mu)} }  
=
\int{} D\eta^{\dagger} D\eta ~ \text{exp}\Big(- \sum_{t=1}^{2N_t}\sum_{x \sigma} \eta^{\dagger}_{\sigma}(x,t) \eta_{\sigma}(x,t)\Big)~ \times \\
&
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,2N_t + 1) e^{-\Delta t k }_{xy} \eta_{\sigma}(y,2 N_t)\Bigg] 
~ 
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,2N_t) e^{A_{N_t} + \Delta t \mu}_{xy} \eta_{\sigma}(y,2N_t - 1) \Bigg]  \\
& ... \\
& 
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,5) e^{-\Delta t k }_{xy} \eta_{\sigma}(y,4)\Bigg] 
~ 
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,4) e^{A_2 + \Delta t \mu}_{xy} \eta_{\sigma}(y,3) \Bigg]  \\
& 
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,3) e^{-\Delta t k }_{xy} \eta_{\sigma}(y,2)\Bigg] 
~ 
\text{exp}\Bigg[ \sum_{xy\sigma} \eta^{\dagger}_{\sigma}(x,2) e^{A_1 + \Delta t \mu}_{xy} \eta_{\sigma}(y,1) \Bigg] 
\end{align*}
where $\eta_{2 N_t + 1} \equiv - \eta_1$ and where we use the shorthand
\begin{equation}
D\eta^{\dagger} D\eta \equiv \prod_{t=1}^{2N_t} \Bigg\{ \prod_{x, \sigma} d \eta^{\dagger}_{\sigma}(x,t) d\eta_{\sigma}(x,t) \Bigg\}
\end{equation}

 Ok, we are almost there. The next step is to choose how we're going to organize Grassmann variables. I will take the following convention:
\begin{equation*}
\eta = \begin{bmatrix} \eta_1 \\ \eta_2 \end{bmatrix}
\end{equation*} 
where $\eta_1, \eta_2$ are lists of Grassmann variables of length space $\times$ time. In this arrangement, spin is the ``slowest" variable. Then, in the equation above, we can gather all terms involving spin 1 into one sum, and all the terms with spin 2 into another sum:
\begin{align*}
& \tr{\prod_{t=1}^{N_t} e^{-\Delta t K}  e^{ \tilde{n}\cdot (A_t + \Delta t \mu)} }  
= \\
& \int{}  D\eta^{\dagger} D\eta ~ \text{exp}\Big(- \big[ \sum_{x t x' t'} \eta_1^{\dagger}(x,t) D^{11}_{(x,t),(x't')} \eta_1(x',t') + \sum_{x t x' t'} \eta_2^{\dagger}(x,t) D^{22}_{(x,t),(x't')} \eta_2(x',t')  \big]  \Big) = \\
& \int{}  D\eta^{\dagger} D\eta~ 
\text{exp}\Big(-
\begin{bmatrix}
\eta_1^{\dagger} & \eta_2^{\dagger}
\end{bmatrix}
\begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}
\begin{bmatrix}
\eta_1^{\dagger} \\ \eta_2^{\dagger}
\end{bmatrix}
 \Big) = \text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}~,
\end{align*}
where both $D^{11}$ and $D^{22}$ are square matrices of side-length spacetime. In this case where we have only coupled to $-\mu N$, $D^{11} = D^{22} = D$ where
\begin{equation}
D = \begin{bmatrix} 
\mathbf{1} & 0 & 0 & 0 & 0 & ... & 0 & 0 &  B^{-1} \\
-e^{A_1+\Delta t \mu} & \mathbf{1} & 0 & 0 & 0 & ... & 0 & 0 & 0 \\
0 & -B^{-1} & \mathbf{1} & 0 & 0 & ... & 0 & 0 & 0 \\
0 & 0 & -e^{A_2+\Delta t \mu} & \mathbf{1} & 0 & ... & 0 & 0 & 0 \\
0 & 0 & 0 & -B^{-1} & \mathbf{1} & ... & 0 & 0 & 0 \\
. & . & . & . & . & ... & . & . & . \\
. & . & . & . & . & ... & . & . & . \\
. & . & . & . & . & ... & . & . & . \\
0 & 0 & 0 & 0 & 0 & ... &  -B^{-1} & \mathbf{1} & 0 \\
0 & 0 & 0 & 0 & 0 & ... & 0 & -e^{A_{N_t}+\Delta t \mu} & \mathbf{1} \\
\end{bmatrix}
\end{equation}
and $B^{-1} = e^{-\Delta t k}$. Notice that $D$ is a block matrix with $2N_t$ blocks per side. Here is another block matrix, but with only $N_t$ blocks per side,
\begin{equation}
D' = \begin{bmatrix}
B & 0 & 0 & 0 & ... & 0 & e^{A_{N_t}+ \Delta t \mu} \\
-e^{A_1+ \Delta t \mu} & B & 0 & 0 & ... & 0 & 0 \\
0 & -e^{A_2+ \Delta t \mu} & B & 0 & ... & 0 & 0 \\
0 & 0 & -e^{A_3+ \Delta t \mu} & B & ... & 0 & 0 \\
. & . & . & . & ... & . & . \\
. & . & . & . & ... & . & . \\
. & . & . & . & ... & . & . \\
0 & 0 & 0 & 0 & ... & B & 0 \\
0 & 0 & 0 & 0 & ... & -e^{A_{N_t-1}+ \Delta t \mu} & B \\
\end{bmatrix}
\end{equation} 
which satisfies
\begin{equation}
\text{det}\, D = \frac{ \text{det}\, D' }{ \text{det}\, B^{N_t} }
\end{equation}
Since the two matrices differ by a constant factor, either may be used in simulations; we use the latter. Therefore, one finally has
\begin{align*}
& \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V - \mu N)}  } = \Bigg( {\text{det} B}^{2N_t} {\int DA ~ e^{-\frac{1}{2} \sum_t {A}(x,t) M_{xy} A(y,t)}} \Bigg)^{-1} \times \\
&
\int DA D\eta^{\dagger} D \eta ~ \text{exp}\Bigg[-\Big( \frac{1}{2} \sum_{x y t} A(x,t) M_{xy} A(y,t) + \sum_{x y t \sigma}\eta_{\sigma}^{\dagger}(x,t) B_{x y} \eta_{\sigma}(y,t) - \sum_{x t \sigma}\eta_{\sigma}^{\dagger}(x,t+1) e^{A(x,t) + \Delta t \mu} \eta_{\sigma}(x,t) \Bigg] 
~.
\end{align*}
Therefore, the action for this theory is 
\begin{equation}
S =  \frac{1}{2} \sum_{x y t} A(x,t) M_{xy} A(y,t) + \sum_{x y t \sigma}\eta_{\sigma}^{\dagger}(x,t) B_{x y} \eta_{\sigma}(y,t) - \sum_{x t \sigma}\eta_{\sigma}^{\dagger}(x,t+1) e^{A(x,t) + \Delta t \mu} \eta_{\sigma}(x,t)
\end{equation}


\subsection{Spin Chemical Potentials}
To explore the spin polarized system, we have to couple to a spin chemical potential. In this section we will work out the corresponding changes to the fermion matrix. We wish to examine
\begin{equation*}
H - \mu N - h_i S_i, ~~~ S_i = \frac{1}{2} \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_i)_{\alpha \beta} \tilde{\psi}_{\beta}(x)
\end{equation*}
where $\sigma_i$ are the Pauli matrices. In this case the trotterized partition function is 
\begin{equation}
\tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N-h_i S_i)}  }~,
\end{equation}
and the new Hubbard-Stratanovich transformation is 
\begin{align*}
& \frac{\int d {A} e^{-\frac{1}{2} {A}^T M A + \tilde{n} \cdot (A+\Delta t \mu) + \frac{1}{2}  \Delta t h_i \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_i)_{\alpha \beta} \tilde{\psi}_{\beta}(x)  } }{ \int d {A} e^{-\frac{1}{2} {A}^T M A  } } = \\
& \text{exp}\Bigg( \frac{1}{2} \sum_{x y}\tilde{n}(x) (M^{-1})_{xy} \tilde{n}(y) + \Delta t \mu \sum_x \tilde{n}(x) + \frac{1}{2}  \Delta t h_i \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_i)_{\alpha \beta} \tilde{\psi}_{\beta}(x) \Bigg) ~.
\end{align*}
\textcolor{red}{Is this even right if the operators don't commute??} This new HS transformation looks pretty ugly but it's really not that bad. The only element of the story that changes is the matrix element
\begin{align*}
& \langle \eta | e^{ \tilde{n} \cdot (A+\Delta t \mu) + \frac{1}{2}  \Delta t h_i \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_i)_{\alpha \beta} \tilde{\psi}_{\beta}(x) } | \eta' \rangle = \\
& \langle \eta | e^{ \sum_x n(x) (A(x)+\Delta t \mu) + \frac{1}{2}  \Delta t h_i \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_i)_{\alpha \beta} \tilde{\psi}_{\beta}(x) } | \eta' \rangle = \\ 
& =
\langle \eta | \text{exp}\Bigg( 
\begin{bmatrix} \tilde{\Psi}^{\dagger}_{1} &  \tilde{\Psi}^{\dagger}_{2}  \end{bmatrix} 
\begin{bmatrix}
A + \Delta t \mu + \frac{1}{2}\Delta t h_3 & \frac{1}{2}(h_1 - i h_2) \\
\frac{1}{2}(h_1 + i h_2) & A + \Delta t \mu - \frac{1}{2}\Delta t h_3 
\end{bmatrix} 
\begin{bmatrix} \tilde{\Psi}_{1} \\  \tilde{\Psi}_{2}  \end{bmatrix} \Bigg)
| \eta' \rangle \\
& =
\text{exp}\Bigg( 
\begin{bmatrix} \eta^{\dagger}_{1} &  \eta^{\dagger}_{2}  \end{bmatrix} 
e^{\begin{bmatrix}
A + \Delta t \mu + \frac{1}{2}\Delta t h_3 & \frac{1}{2}(h_1 - i h_2) \\
\frac{1}{2}(h_1 + i h_2) & A + \Delta t \mu - \frac{1}{2}\Delta t h_3 
\end{bmatrix}}
\begin{bmatrix} \eta_{1} \\  \eta_{2}  \end{bmatrix} \Bigg) .
\end{align*}
Here I've abused notation a little by defining the matrix $(A)_{xy} = \delta_{xy} A(x)$. Also, all additional matrices appearing in the equation above are proportional to the identity matrix in space. Anyway, this is where shit gets fucked up: the exponential matrix
\begin{equation*}
e^{\begin{bmatrix}
A + \Delta t \mu + \frac{1}{2}\Delta t h_3 & \frac{1}{2}(h_1 - i h_2) \\
\frac{1}{2}(h_1 + i h_2) & A + \Delta t \mu - \frac{1}{2}\Delta t h_3 
\end{bmatrix}}
\end{equation*}
is totally non-trivial to unpack.

If we only couple to $S_3$ then the answer remains simple 
\begin{align*}
\langle \eta | e^{  \tilde{n} \cdot (A+\Delta t \mu) + \frac{1}{2}  \Delta t h_3 \sum_x \tilde{\psi}_{\alpha}(x) (\sigma_3)_{\alpha \beta} \tilde{\psi}_{\beta}(x)  } | \eta' \rangle 
& = 
\text{exp}\Bigg( 
\sum_{xy}\eta^{\dagger}_1(x) e^{A_t + \Delta t (\mu + h_3 / 2)}_{xy} \eta_1'(y) + \sum_{xy}\eta^{\dagger}_2(x) e^{A_t + \Delta t (\mu - h_3 / 2)}_{xy} \eta_2'(y) \Bigg)~,
\end{align*}
and one finds the following in the spin-doped theory:
\begin{align*}
& \tr{\prod_{t=1}^{N_t} e^{-\Delta t K}  e^{ \tilde{n}\cdot (A_t + \Delta t \mu) + \Delta t h_3 S_3} }  
= \\
& \int{}  D\eta^{\dagger} D\eta~ 
\text{exp}\Big(-
\begin{bmatrix}
\eta_1^{\dagger} & \eta_2^{\dagger}
\end{bmatrix}
\begin{bmatrix}
\mathcal{D}^{11} & 0 \\ 
0 & \mathcal{D}^{22}
\end{bmatrix}
\begin{bmatrix}
\eta_1^{\dagger} \\ \eta_2^{\dagger}
\end{bmatrix}
 \Big) = \text{det}
 \begin{bmatrix}
\mathcal{D}^{11} & 0 \\ 
0 & \mathcal{D}^{22}
\end{bmatrix}~,
\end{align*}
where $\mathcal{D}^{11} = e^{\Delta t h_3 / 2 }D^{11}$ and $\mathcal{D}^{22} = e^{-\Delta t h_3 / 2 }D^{22}$ .


\subsection{Local Chemical Potentials $\&$ Correlation Functions}
In this section we'll work out how to write
\begin{equation*}
\frac{\tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)} n_{\sigma}(x)}}{\tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  } }, ~~ \frac{ \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)} n_{\sigma}(x) n_{\sigma'}(x')} }{ \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  } }, ~~ ....
\end{equation*}
I know two ways to compute these correlation functions: functional derivatives and operator insertions. The operator insertion method involves completely re-doing the Grassmann algebra, but with the operator inserted. I have several operators worked out this way in my notes, but it's really laborious. Functional derivatives produce the exact same answer and are easier to compute, so we'll do that here.

We will couple a local chemical potential to the rightmost timeslice:
\begin{equation*}
\tr{\prod_{t=1}^{N_t-1} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)} e^{-\Delta t K }  e^{-\Delta t (V -\sum_{\sigma x}{\mu_{\sigma}(x) n_{\sigma}(x) })}  } 
\end{equation*}
If we work out this trace, then we can evaluate 
\begin{align*}
& \frac{
 \frac{1}{\Delta t^2} \frac{\partial}{ {\partial\mu_{\sigma}(x) }} \frac{\partial}{ {\partial\mu_{\sigma'}(x')} }  \tr{\prod_{t=1}^{N_t-1} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)} e^{-\Delta t K }  e^{-\Delta t (V -\sum_{\sigma x}{\mu_{\sigma}(x) n_{\sigma}(x) })}  } |_{\mu_{\sigma}(x) = \mu}
 }{ 
 \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  } 
 } 
 =  \\
&  \frac{ \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)} n_{\sigma}(x) n_{\sigma'}(x')} }{ \tr{\prod_{t=1}^{N_t} e^{-\Delta t K }  e^{-\Delta t (V -\mu N)}  } }
\end{align*}
Working out the trace in terms of Grassmann integrals, the only factor that changes due to the local chemical potential is the very first, which is modified to 
\begin{equation}
\text{exp}\Bigg[
 \sum_{xy} \eta^{\dagger}_{1}(x,2) (e^{ \sum_z A_1(z) + \Delta t \mu_1(z)})_{xy} \eta_{1}(y,1)
 +
  \sum_{xy} \eta^{\dagger}_{2}(x,2) (e^{ \sum_z A_1(z) + \Delta t \mu_2(z)})_{xy} \eta_{2}(y,1) 
  \Bigg] 
\end{equation}
where 
\begin{equation}
(e^{ \sum_z A_1(z) + \Delta t \mu_{\sigma}(z)})_{xy} = \delta_{xy} e^{ A_1(x) + \Delta t \mu_{\sigma}(x)}~.
\end{equation}
This modification changes the (2,1) time block of the Fermion matrix for both spins. Now the matrices read
\begin{equation}
D^{\sigma \sigma } = \begin{bmatrix} 
\mathbf{1} & 0 & 0 & 0 & 0 & ... & 0 & 0 &  B^{-1} \\
-e^{\sum_z A_1(z)+\Delta t \mu_{\sigma}(z)} & \mathbf{1} & 0 & 0 & 0 & ... & 0 & 0 & 0 \\
0 & -B^{-1} & \mathbf{1} & 0 & 0 & ... & 0 & 0 & 0 \\
0 & 0 & -e^{A_2+\Delta t \mu} & \mathbf{1} & 0 & ... & 0 & 0 & 0 \\
0 & 0 & 0 & -B^{-1} & \mathbf{1} & ... & 0 & 0 & 0 \\
. & . & . & . & . & ... & . & . & . \\
. & . & . & . & . & ... & . & . & . \\
. & . & . & . & . & ... & . & . & . \\
0 & 0 & 0 & 0 & 0 & ... &  -B^{-1} & \mathbf{1} & 0 \\
0 & 0 & 0 & 0 & 0 & ... & 0 & -e^{A_{N_t}+\Delta t \mu} & \mathbf{1} \\
\end{bmatrix}
\end{equation}
Using the Shur complement, one has
\begin{align*} 
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}
= & 
\text{det}\Big( \mathbf{1} + B^{-1} e^{A_{N_t}+\Delta t \mu} ... B^{-1} e^{\sum_zA_{1}(z)+\Delta t \mu_1(z)}\Big) \times \\
& \text{det}\Big( \mathbf{1} + B^{-1} e^{A_{N_t}+\Delta t \mu} ... B^{-1} e^{\sum_zA_{1}(z)+\Delta t \mu_2(z)}\Big)
\end{align*}
Let's define
\begin{equation}
U_{\sigma} \equiv B^{-1} e^{A_{N_t}+\Delta t \mu} ... B^{-1} e^{\sum_zA_{1}(z)+\Delta t \mu_1(z)} 
\end{equation}
Defining the projector $(P_z)_{xy} = \delta_{xy} \delta_{xz}$ (no sum), one has
\begin{equation*}
\frac{1}{\Delta t} \frac{\partial}{\partial \mu_\sigma(x)}e^{\sum_zA_{1}(z)+\Delta t \mu_{\sigma}(z)} = e^{\sum_zA_{1}(z)+\Delta t \mu_{\sigma}(z)} P_x 
\end{equation*}
This basic identity leads one to the following:
\begin{align*}
\frac{1}{\Delta t} \frac{\partial}{\partial \mu_\sigma(x)} \text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}
& =
\text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{\sigma})^{-1} \Big\} P_x \Big)
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} \\
& = 
\Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{\sigma})^{-1} \Big\} \Big)_{xx}
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} \\
\end{align*} 
and 
\begin{align*}
\frac{1}{\Delta t} \frac{\partial}{\partial \mu_1(x)} \frac{1}{\Delta t} \frac{\partial}{\partial \mu_2(x')} \text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}
& =
\text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big\} P_x \Big) 
\text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{2})^{-1} \Big\} P_x' \Big)
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} \\
& = 
\Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big\} \Big)_{xx}
\Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{2})^{-1} \Big\} \Big)_{x'x'}
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} \\
\end{align*} 
and
\begin{align*}
& \frac{1}{\Delta t} \frac{\partial}{\partial \mu_1(x)} \frac{1}{\Delta t} \frac{\partial}{\partial \mu_1(x')} \text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix}
= \\
&\Bigg\{ \text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big\} P_x \Big) 
\text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big\} P_x' \Big)
+ 
\text{tr} \Big(\Big\{ \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big\} P_x (1+U_1)^{-1} P_{x'}\Big) 
 \Bigg\}
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} 
= \\
&\Bigg\{  \Big( \mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big)_{xx} 
 \Big(\mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big)_{x' x'}
+ 
 \Big(\mathbf{1} - (\mathbf{1} + U_{1})^{-1} \Big)_{x x'} \Big( (\mathbf{1}+U_1)^{-1} \Big)_{x' x} 
 \Bigg\}
\text{det}
 \begin{bmatrix}
D^{11} & 0 \\ 
0 & D^{22}
\end{bmatrix} 
\end{align*} 
This final identity also holds when $1\rightarrow 2$ . There you have it: these derivatives can be used to compute correlation functions. One warning to keep in mind is that $U_{\sigma}$ ends not with a $B^{-1}$ matrix, but with an auxiliary field matrix. On this ``first timeslice" example, we end with the very first auxiliary field matrix
\begin{equation}
U_{\sigma} \equiv B^{-1} e^{A_{N_t}+\Delta t \mu} ... B^{-1} e^{\sum_zA_{1}(z)+\Delta t \mu_1(z)} ~.
\end{equation}
Now time translations of $U_{\sigma}$ produce the same averages, however it's important that any time-translated sausage ends with not a $B^{-1}$ but with an auxiliary field matrix.




